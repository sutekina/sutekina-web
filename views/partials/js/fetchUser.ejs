<script async type="module">
    let urlSearchParams = new URLSearchParams(window.location.search);
    let params = Object.fromEntries(urlSearchParams.entries());
    
    let username = document.getElementById("user-identifier").dataset.user;

    
    var user = await fetch(new Request(`https://api.sutekina.tk/v2/users/${username}`)).then(res => {
        return res.json();
    });
    
    document.getElementsByClassName("user-icon")[0].style.backgroundImage = `url('https://a.sutekina.tk/${user.userId}')`;

    var nextBestPage = 0;
    var best = await getScores({name: "pp", asc: "false"}, nextBestPage);
    nextBestPage++;
    var nextRecentPage = 0;
    var recent = await getScores({name:"playtime", asc: "false"}, nextRecentPage, "0", "-2");
    nextRecentPage++;

    console.log(user);
    // {"userId":3,"name":"Felix","country":"de","privilege":31751,"creationTime":1611740740,"playtime":7560,"playcount":299,"pp":1030,"accuracy":81.22599792480469,"globalRank":24,"countryRank":1}
    console.log(recent);
    console.log(best)

    function getScores(order, nextPage, scoreStatus = "1", beatmapStatus = "2") {
        return new Promise(async (resolve, reject) => {
            try {
                console.log(`https://api.sutekina.tk/v2/users/${username}/scores?limit=5&offset=${nextPage*5}&order=${order.name}&ascending=${order.asc}&scoreStatus=${scoreStatus}&beatmapStatus=${beatmapStatus}`)
                let response = await fetch(new Request(`https://api.sutekina.tk/v2/users/${username}/scores?limit=5&offset=${nextPage*5}&order=${order.name}&ascending=${order.asc}&scoreStatus=${scoreStatus}&beatmapStatus=${beatmapStatus}`)).then(res => {
                    return res.json();
                });
                resolve(response);
            } catch(err) {
                reject(err);
            }
        })
    }
</script>